# 工数管理システム (Man-Hour Management System)

企業やチームにおける工数管理を効率化し、プロジェクトの進捗管理と工数の可視化を実現するWebアプリケーションです。

## 📋 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [システム要件](#システム要件)
- [インストール・セットアップ](#インストールセットアップ)
- [使用方法](#使用方法)
- [ユーザーロール](#ユーザーロール)
- [画面構成](#画面構成)
- [技術仕様](#技術仕様)
- [トラブルシューティング](#トラブルシューティング)
- [サポート](#サポート)

## 🎯 概要

工数管理システムは、プロジェクトベースの工数管理を行うためのWebアプリケーションです。チームメンバーが日々の作業時間を記録し、プロジェクトマネージャーが進捗状況を把握できる環境を提供します。

### 主な特徴

- **直感的なUI**: 使いやすいインターフェースで工数入力が簡単
- **リアルタイム集計**: 入力された工数をリアルタイムで集計・可視化
- **役割ベースアクセス**: 管理者、マネージャー、メンバーの3段階の権限管理
- **プロジェクト管理**: プロジェクト、工程、タスクの階層管理
- **レポート機能**: 工数データの分析とレポート出力

## ✨ 主な機能

### 1. ユーザー管理
- ユーザー登録・認証
- 役割ベースのアクセス制御（ADMIN、MANAGER、MEMBER）
- セキュアなログイン・ログアウト機能

### 2. プロジェクト管理
- プロジェクトの作成・編集・削除
- プロジェクトステータス管理（進行中、完了、保留）
- プロジェクトマネージャーの割り当て

### 3. 工程・タスク管理
- プロジェクト内の工程（Phase）管理
- 工程内のタスク管理
- 見積工数の設定と実績との比較

### 4. 工数入力・管理
- 日次工数入力機能
- 工数の編集・削除機能
- 一括工数入力機能
- カレンダー形式での工数確認

### 5. ダッシュボード・レポート
- プロジェクト別工数集計
- 工程別工数集計
- 月次レポート機能
- 進捗状況の可視化

## 💻 システム要件

### 必要な環境
- Node.js 18.0.0 以上
- PostgreSQL 12.0 以上
- モダンブラウザ（Chrome、Firefox、Safari、Edge）

### 推奨環境
- Node.js 20.0.0 以上
- PostgreSQL 15.0 以上
- メモリ: 4GB以上
- ストレージ: 10GB以上の空き容量

## 🚀 インストール・セットアップ

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd man-hour-management
```

### 2. 依存関係のインストール

```bash
npm install
```

### 3. 環境変数の設定

`.env`ファイルを作成し、以下の環境変数を設定してください：

```env
# データベース接続URL
DATABASE_URL="postgresql://username:password@localhost:5432/manhour_db"
```

### 4. データベースのセットアップ

```bash
# Prismaマイグレーションの実行
npx prisma migrate dev

# 初期データの投入（オプション）
npx prisma db seed
```

### 5. アプリケーションの起動

```bash
# 開発サーバーの起動
npm run dev
```

アプリケーションは `http://localhost:3000` でアクセスできます。

### 6. 初期管理者アカウントの作成

初回起動時は、管理者画面（`/admin`）から初期データを作成してください。

## 📖 使用方法

### 初回ログイン

1. ブラウザで `http://localhost:3000` にアクセス
2. 管理者によって作成されたアカウントでログイン
3. ダッシュボードが表示されます

### 工数入力の流れ

1. **プロジェクト選択**: 作業対象のプロジェクトを選択
2. **工程・タスク選択**: 該当する工程とタスクを選択
3. **工数入力**: 作業日、作業時間、作業内容を入力
4. **保存**: 入力内容を確認して保存

### プロジェクト管理（マネージャー以上）

1. **プロジェクト作成**: 新規プロジェクトの基本情報を入力
2. **工程設定**: プロジェクト内の工程を定義
3. **タスク設定**: 各工程内のタスクを設定
4. **メンバー割り当て**: プロジェクトメンバーを割り当て

## 👥 ユーザーロール

### ADMIN（管理者）
- 全システムの管理権限
- ユーザー管理（作成・編集・削除）
- 全プロジェクトへのアクセス
- システム設定の変更

### MANAGER（マネージャー）
- 担当プロジェクトの管理
- プロジェクト・工程・タスクの作成・編集
- チームメンバーの工数確認
- レポートの閲覧・出力

### MEMBER（メンバー）
- 自分の工数入力・編集
- 参加プロジェクトの閲覧
- 自分の工数履歴の確認

## 🖥️ 画面構成

### メイン画面

| 画面名 | URL | 説明 | アクセス権限 |
|--------|-----|------|-------------|
| ログイン | `/login` | システムへのログイン | 全ユーザー |
| ダッシュボード | `/dashboard` | 工数サマリーと最近の活動 | 全ユーザー |
| 工数入力 | `/time-entry` | 日次工数の入力・編集 | 全ユーザー |
| プロジェクト一覧 | `/projects` | プロジェクト一覧と管理 | 全ユーザー |
| プロジェクト詳細 | `/projects/[id]` | プロジェクトの詳細情報 | 全ユーザー |
| 工程管理 | `/projects/[id]/phases` | 工程とタスクの管理 | MANAGER以上 |
| ユーザー管理 | `/users` | ユーザーアカウントの管理 | ADMIN |
| レポート | `/reports` | 工数レポートの閲覧 | MANAGER以上 |
| 管理画面 | `/admin` | システム管理機能 | ADMIN |

### 主要機能の操作方法

#### 工数入力
1. 「工数入力」メニューをクリック
2. 日付を選択（デフォルトは今日）
3. プロジェクト、工程、タスクを順番に選択
4. 作業時間（時間）を入力
5. 作業内容を記述（任意）
6. 「保存」ボタンをクリック

#### 一括工数入力
1. 工数入力画面で「一括入力」ボタンをクリック
2. 期間を指定
3. 同じ作業内容を複数日に一括で入力可能

## 🔧 技術仕様

### フロントエンド
- **フレームワーク**: Next.js 15.3.4
- **言語**: TypeScript
- **UIライブラリ**: React 19.0.0
- **スタイリング**: Tailwind CSS 4.0
- **状態管理**: React Context API

### バックエンド
- **API**: Next.js API Routes
- **ORM**: Prisma 6.10.1
- **データベース**: PostgreSQL
- **認証**: bcryptjs（パスワードハッシュ化）

### セキュリティ
- パスワードのハッシュ化（bcryptjs）
- セッションベース認証
- 役割ベースアクセス制御（RBAC）
- SQLインジェクション対策（Prisma ORM）

### データベース構造

```
User (ユーザー)
├── Project (プロジェクト) - 1:N（マネージャー関係）
│   ├── Phase (工程) - 1:N
│   │   └── Task (タスク) - 1:N
│   └── TimeEntry (工数入力) - 1:N
└── TimeEntry (工数入力) - 1:N
```

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### データベース接続エラー
```
Error: Can't reach database server
```
**解決方法**:
1. PostgreSQLサービスが起動しているか確認
2. `.env`ファイルの`DATABASE_URL`が正しいか確認
3. データベースが存在するか確認

#### マイグレーションエラー
```
Error: Migration failed
```
**解決方法**:
```bash
# マイグレーションをリセット
npx prisma migrate reset
# 再度マイグレーション実行
npx prisma migrate dev
```

#### ログインできない
**解決方法**:
1. 管理者画面（`/admin`）から初期データを作成
2. ユーザーアカウントが正しく作成されているか確認
3. パスワードが正しいか確認

#### 工数入力時のエラー
**解決方法**:
1. プロジェクト、工程、タスクが正しく設定されているか確認
2. 入力値（時間）が数値形式か確認
3. 必須項目がすべて入力されているか確認

### ログの確認方法

開発環境でのログ確認：
```bash
# アプリケーションログ
npm run dev

# データベースログ
npx prisma studio
```

## 📞 サポート

### 開発・運用サポート

技術的な問題や機能要望については、以下の方法でお問い合わせください：

1. **Issue報告**: GitHubのIssueページで問題を報告
2. **機能要望**: 新機能の提案や改善要望
3. **バグ報告**: 不具合の詳細な報告

### システム管理者向け情報

#### 定期メンテナンス
- データベースのバックアップ（推奨：日次）
- ログファイルのローテーション
- セキュリティアップデートの適用

#### パフォーマンス監視
- データベースのパフォーマンス監視
- アプリケーションのレスポンス時間監視
- ディスク使用量の監視

---

## 📄 ライセンス

このプロジェクトは社内利用を目的として開発されています。

## 🔄 更新履歴

- **v0.1.0** (2025/06): 初期リリース
  - 基本的な工数管理機能
  - ユーザー管理機能
  - プロジェクト管理機能
  - ダッシュボード機能

## 🚀 Vercelデプロイ手順

### 前提条件
- Vercelアカウントの作成
- GitHubリポジトリの準備
- PostgreSQLデータベースの準備（Neon、Supabase、PlanetScale等）

### 1. データベースの準備

本番環境用のPostgreSQLデータベースを準備してください。推奨サービス：

- **Neon** (https://neon.tech/) - PostgreSQL専用、無料プランあり
- **Supabase** (https://supabase.com/) - PostgreSQL + 追加機能、無料プランあり
- **PlanetScale** (https://planetscale.com/) - MySQL、無料プランあり

### 2. Vercelプロジェクトの作成

1. Vercel Dashboard (https://vercel.com/dashboard) にアクセス
2. 「New Project」をクリック
3. GitHubリポジトリを選択してインポート

### 3. 環境変数の設定

Vercel Dashboard > Settings > Environment Variables で以下を設定：

```env
DATABASE_URL=postgresql://username:password@hostname:port/database_name?schema=public
JWT_SECRET=your-super-secret-jwt-key-for-production
```

**重要**: 本番環境では強力なJWT_SECRETを生成してください：
```bash
# 強力なシークレットキーの生成例
openssl rand -base64 32
```

### 4. ビルド設定の確認

Vercel Dashboard > Settings > General で以下を確認：

- **Framework Preset**: Next.js
- **Build Command**: `prisma generate && next build` (自動設定済み)
- **Output Directory**: `.next` (自動設定)
- **Install Command**: `npm install` (自動設定)

### 5. データベースマイグレーション

初回デプロイ後、データベースのマイグレーションを実行：

```bash
# ローカルで本番データベースに対してマイグレーション実行
DATABASE_URL="your-production-database-url" npx prisma migrate deploy

# 初期データの投入（必要に応じて）
DATABASE_URL="your-production-database-url" npx prisma db seed
```

### 6. デプロイの実行

1. GitHubにコードをプッシュ
2. Vercelが自動的にビルド・デプロイを開始
3. デプロイ完了後、提供されるURLでアクセス確認

### 7. 初期設定

1. デプロイされたアプリケーションにアクセス
2. `/admin` ページで初期データを作成
3. 管理者アカウントでログインして動作確認

### トラブルシューティング

#### ビルドエラーが発生する場合
```bash
# ローカルでビルドテスト
npm run build
```

#### データベース接続エラーの場合
- 環境変数 `DATABASE_URL` が正しく設定されているか確認
- データベースサービスが稼働しているか確認
- 接続文字列の形式が正しいか確認

#### Prismaエラーの場合
```bash
# Prismaクライアントの再生成
npx prisma generate
```

### パフォーマンス最適化

本番環境でのパフォーマンス向上のため：

1. **データベース接続プール**: 適切な接続数の設定
2. **CDN活用**: 静的ファイルの配信最適化
3. **キャッシュ戦略**: API レスポンスのキャッシュ設定

---

**工数管理システム開発チーム**
