# 🚀 工数管理システム (Man-Hour Management System)

[![Production Status](https://img.shields.io/badge/Production-Live-green)](https://vercel.com)
[![Next.js](https://img.shields.io/badge/Next.js-15.3.4-black)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-blue)](https://www.typescriptlang.org/)
[![Prisma](https://img.shields.io/badge/Prisma-6.10.1-2D3748)](https://www.prisma.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-336791)](https://www.postgresql.org/)

企業やチームにおける工数管理を効率化し、プロジェクトの進捗管理と工数の可視化を実現するWebアプリケーションです。

**🎉 本番環境稼働中**: Vercel + Neon PostgreSQL で安定運用中

## 📋 目次

- [概要](#-概要)
- [主な機能](#-主な機能)
- [本番環境情報](#-本番環境情報)
- [技術スタック](#-技術スタック)
- [クイックスタート](#-クイックスタート)
- [開発環境セットアップ](#-開発環境セットアップ)
- [使用方法](#-使用方法)
- [ユーザーロール](#-ユーザーロール)
- [画面構成](#️-画面構成)
- [API仕様](#-api仕様)
- [デプロイメント](#-デプロイメント)
- [トラブルシューティング](#-トラブルシューティング)
- [開発ガイド](#-開発ガイド)

## 🎯 概要

工数管理システムは、プロジェクトベースの工数管理を行うためのWebアプリケーションです。チームメンバーが日々の作業時間を記録し、プロジェクトマネージャーが進捗状況を把握できる環境を提供します。

### 🌟 主な特徴

- **🎨 直感的なUI**: モダンなデザインで使いやすいインターフェース
- **⚡ リアルタイム集計**: 入力された工数をリアルタイムで集計・可視化
- **🔐 役割ベースアクセス**: 管理者、マネージャー、メンバーの3段階の権限管理
- **📊 高度な分析**: WBS管理、ガントチャート、進捗ダッシュボード
- **🏢 組織管理**: 4階層組織構造（会社→事業部→部署→グループ）
- **📱 レスポンシブ**: モバイル・タブレット対応
- **🚀 本番稼働**: Vercel + Neon PostgreSQL で安定運用

### 🎯 解決する課題

- **工数管理の非効率性**: Excelやスプレッドシートでの手動管理による時間の浪費
- **プロジェクト可視化の欠如**: プロジェクトの進捗状況が見えにくい
- **レポート作成の負担**: 月次・週次レポートの作成に時間がかかる

## ✨ 主な機能

### 🔐 認証・ユーザー管理
- セキュアなログイン・ログアウト機能
- 役割ベースのアクセス制御（ADMIN、MANAGER、MEMBER）
- ユーザープロファイル管理
- 組織階層管理（会社→事業部→部署→グループ）

### 📋 プロジェクト管理
- プロジェクトの作成・編集・削除
- プロジェクトステータス管理（進行中、完了、保留）
- プロジェクトマネージャーの割り当て
- 工程（Phase）とタスクの階層管理

### ⏱️ 工数入力・管理
- **日次工数入力**: 直感的なフォームでの工数入力
- **一括工数入力**: カレンダー形式での複数日一括入力
- **工数編集・削除**: 入力済み工数の修正・削除
- **履歴管理**: 個人・チーム単位での工数履歴確認

### 📊 WBS管理システム（新機能）
- **WBS作業管理**: 独立した作業管理システム
- **ガントチャート**: 作業スケジュールの可視化
- **進捗ダッシュボード**: 担当者別作業負荷分析
- **カレンダー表示**: 作業予定・実績のカレンダー表示
- **一括操作**: 複数作業の一括登録・更新

### 📈 ダッシュボード・レポート
- **リアルタイム集計**: プロジェクト別・工程別工数集計
- **進捗可視化**: グラフィカルな進捗表示
- **月次比較**: 期間別の工数比較分析
- **遅延分析**: 予定と実績の乖離分析
- **効率性分析**: チーム・個人の生産性分析

### 🏢 組織管理
- **4階層組織**: 会社→事業部→部署→グループ
- **組織マスタ管理**: 各階層の作成・編集・削除
- **ユーザー所属管理**: 組織への所属設定
- **組織別統計**: 組織単位での工数集計

## 🌐 本番環境情報

### ✅ 稼働状況
- **プラットフォーム**: Vercel（Edge Network活用）
- **データベース**: Neon PostgreSQL（本番用）
- **SSL/CDN**: 自動設定済み
- **スケーリング**: 自動スケーリング対応
- **監視**: Vercel Analytics活用

### 🔑 本番環境ログイン情報
```
会社コード: 00001
メールアドレス: sasao@sas-com.com
パスワード: ts05140952
所属: SAS株式会社 > SI事業部 > 流通サービス部 > 通販サービスGr
```

### 📊 本番環境データ
- **組織**: SAS株式会社（2事業部、4部署、1グループ）
- **ユーザー**: 管理者アカウント設定済み
- **サンプルデータ**: プロジェクト・工程・タスクのサンプル作成済み

## 🛠️ 技術スタック

### フロントエンド
- **Next.js 15.3.4**: React フレームワーク（App Router使用）
- **React 19.0.0**: UIライブラリ
- **TypeScript 5**: 型安全性の確保
- **Tailwind CSS 4.0**: ユーティリティファーストCSS
- **React Context API**: 状態管理

### バックエンド
- **Next.js API Routes**: サーバーサイドAPI
- **Prisma 6.10.1**: ORM（Object-Relational Mapping）
- **PostgreSQL**: リレーショナルデータベース
- **bcryptjs 3.0.2**: パスワードハッシュ化

### インフラ・デプロイ
- **Vercel**: ホスティング・CI/CD
- **Neon PostgreSQL**: マネージドPostgreSQL
- **Edge Network**: グローバル配信
- **SSL/TLS**: 自動証明書管理

## 🚀 クイックスタート

### 本番環境へのアクセス

1. **本番環境URL**: [デプロイされたURL]
2. **ログイン**: 上記の本番環境ログイン情報を使用
3. **初回利用**: ダッシュボードで機能を確認

### ローカル開発環境

```bash
# リポジトリのクローン
git clone <repository-url>
cd man-hour-management

# 依存関係のインストール
npm install

# 環境変数の設定
cp .env.example .env
# .envファイルを編集してDATABASE_URLを設定

# データベースのセットアップ
npx prisma migrate dev
npx prisma db seed

# 開発サーバーの起動
npm run dev
```

## 💻 開発環境セットアップ

### 必要な環境
- **Node.js**: 18.0.0 以上（推奨: 20.0.0 以上）
- **PostgreSQL**: 12.0 以上（推奨: 15.0 以上）
- **Git**: バージョン管理
- **モダンブラウザ**: Chrome、Firefox、Safari、Edge

### 詳細セットアップ手順

#### 1. 環境変数の設定

`.env`ファイルを作成：

```env
# データベース接続URL
DATABASE_URL="postgresql://username:password@localhost:5432/manhour_db"

# JWT秘密鍵（開発用）
JWT_SECRET="your-development-jwt-secret"
```

#### 2. データベースの準備

```bash
# PostgreSQLデータベースの作成
createdb manhour_db

# Prismaマイグレーションの実行
npx prisma migrate dev --name init

# Prismaクライアントの生成
npx prisma generate

# 初期データの投入
npx prisma db seed
```

#### 3. 開発サーバーの起動

```bash
# 開発サーバー起動（Turbopack使用）
npm run dev

# または通常モード
npm run dev:normal
```

#### 4. 開発ツール

```bash
# Prisma Studio（データベースGUI）
npx prisma studio

# ESLint実行
npm run lint

# TypeScript型チェック
npx tsc --noEmit
```

## 📖 使用方法

### 基本的な操作フロー

#### 1. 初回ログイン
1. ブラウザで `http://localhost:3000` にアクセス
2. 管理者によって作成されたアカウントでログイン
3. ダッシュボードが表示されます

#### 2. 工数入力の流れ
1. **工数入力画面**: 「工数入力」メニューをクリック
2. **日付選択**: 作業日を選択（デフォルトは今日）
3. **プロジェクト選択**: 作業対象のプロジェクトを選択
4. **工程・タスク選択**: 該当する工程とタスクを選択
5. **工数入力**: 作業時間（時間）と作業内容を入力
6. **保存**: 入力内容を確認して保存

#### 3. 一括工数入力
1. 工数入力画面で「一括入力」ボタンをクリック
2. 期間を指定（開始日〜終了日）
3. 同じ作業内容を複数日に一括で入力
4. カレンダー形式で日付を選択可能

#### 4. WBS管理（新機能）
1. **WBS画面**: 「WBS」メニューをクリック
2. **ガントチャート**: 作業スケジュールを可視化
3. **ダッシュボード**: 進捗状況と負荷分析
4. **カレンダー**: 作業予定・実績をカレンダー表示
5. **一括操作**: 複数作業の一括登録・更新

### プロジェクト管理（マネージャー以上）

#### 1. プロジェクト作成
1. 「プロジェクト」メニューから「新規作成」
2. プロジェクト基本情報を入力
3. プロジェクトマネージャーを割り当て
4. ステータスを設定

#### 2. 工程・タスク設定
1. プロジェクト詳細画面で「工程管理」
2. 工程を作成・順序設定
3. 各工程内にタスクを作成
4. 見積工数を設定

## 👥 ユーザーロール

### 🔴 ADMIN（管理者）
- **権限**: 全システムの管理権限
- **機能**:
  - ユーザー管理（作成・編集・削除）
  - 全プロジェクトへのアクセス
  - 組織管理（会社・事業部・部署・グループ）
  - システム設定の変更
  - 全データの閲覧・編集

### 🟡 MANAGER（マネージャー）
- **権限**: 担当プロジェクトの管理
- **機能**:
  - プロジェクト・工程・タスクの作成・編集
  - チームメンバーの工数確認
  - レポートの閲覧・出力
  - WBS管理・分析
  - 担当プロジェクトのメンバー管理

### 🟢 MEMBER（メンバー）
- **権限**: 自分の作業に関する操作
- **機能**:
  - 自分の工数入力・編集
  - 参加プロジェクトの閲覧
  - 自分の工数履歴の確認
  - 自分の作業に関するWBS操作

## 🖥️ 画面構成

### メイン画面

| 画面名 | URL | 説明 | アクセス権限 |
|--------|-----|------|-------------|
| ログイン | `/login` | システムへのログイン | 全ユーザー |
| ダッシュボード | `/dashboard` | 工数サマリーと最近の活動 | 全ユーザー |
| 工数入力 | `/time-entry` | 日次工数の入力・編集 | 全ユーザー |
| プロジェクト一覧 | `/projects` | プロジェクト一覧と管理 | 全ユーザー |
| プロジェクト詳細 | `/projects/[id]` | プロジェクトの詳細情報 | 全ユーザー |
| 工程管理 | `/projects/[id]/phases` | 工程とタスクの管理 | MANAGER以上 |
| **🆕 WBS管理** | `/wbs` | **WBS統合管理画面** | **全ユーザー** |
| ユーザー管理 | `/users` | ユーザーアカウントの管理 | ADMIN |
| 組織管理 | `/organizations` | 組織階層の管理 | ADMIN |
| 会社管理 | `/companies` | 会社マスタの管理 | ADMIN |
| レポート | `/reports` | 工数レポートの閲覧 | MANAGER以上 |

### 🆕 WBS管理画面の詳細

#### ガントチャートタブ
- 作業スケジュールの可視化
- 予定・実績の比較表示
- 遅延作業のハイライト
- ドラッグ&ドロップでの日程調整

#### ダッシュボードタブ
- 進捗状況の可視化
- 担当者別作業負荷分析
- プロジェクト別進捗レポート
- 効率性分析

#### カレンダータブ
- 月間・週間カレンダー表示
- 作業予定・実績の表示
- 日別作業詳細
- 工数入力との連携

## 🔌 API仕様

### 認証API
```
POST /api/users/login          # ログイン
GET  /api/auth/session         # セッション確認
GET  /api/users/profile        # プロファイル取得
PUT  /api/users/profile        # プロファイル更新
```

### プロジェクト管理API
```
GET    /api/projects           # プロジェクト一覧
POST   /api/projects           # プロジェクト作成
GET    /api/projects/[id]      # プロジェクト詳細
PUT    /api/projects/[id]      # プロジェクト更新
DELETE /api/projects/[id]      # プロジェクト削除
```

### 工程・タスク管理API
```
GET    /api/phases             # 工程一覧
POST   /api/phases             # 工程作成
GET    /api/tasks              # タスク一覧
POST   /api/tasks              # タスク作成
```

### 工数管理API
```
GET    /api/time-entries       # 工数一覧
POST   /api/time-entries       # 工数作成
PUT    /api/time-entries/[id]  # 工数更新
DELETE /api/time-entries/[id]  # 工数削除
```

### 🆕 WBS管理API
```
GET    /api/wbs                # WBS作業一覧
POST   /api/wbs                # WBS作業作成
PUT    /api/wbs/[id]           # WBS作業更新
DELETE /api/wbs/[id]           # WBS作業削除
```

### 組織管理API
```
GET    /api/organizations/companies     # 会社一覧
GET    /api/organizations/divisions     # 事業部一覧
GET    /api/organizations/departments   # 部署一覧
GET    /api/organizations/groups        # グループ一覧
```

### 管理者API
```
POST   /api/admin/init-data            # 初期データ作成
POST   /api/admin/default-data         # デフォルトデータ作成
```

## 🚀 デプロイメント

### 本番環境（Vercel + Neon PostgreSQL）

#### 現在の本番環境構成
- **ホスティング**: Vercel
- **データベース**: Neon PostgreSQL
- **CDN**: Vercel Edge Network
- **SSL**: 自動証明書管理
- **監視**: Vercel Analytics

#### デプロイ手順

1. **Vercelプロジェクト作成**
   ```bash
   # Vercel CLIでデプロイ
   npm install -g vercel
   vercel
   ```

2. **環境変数設定**
   ```env
   DATABASE_URL=postgresql://username:password@hostname:port/database
   JWT_SECRET=your-super-secret-jwt-key-for-production
   ```

3. **データベースマイグレーション**
   ```bash
   # 本番データベースに対してマイグレーション実行
   DATABASE_URL="production-url" npx prisma migrate deploy
   ```

4. **初期データ投入**
   ```bash
   # 組織データを含む初期データ投入
   DATABASE_URL="production-url" node seed-with-organizations.js
   ```

#### 本番環境設定ファイル

**vercel.json**
```json
{
  "buildCommand": "prisma generate && next build",
  "functions": {
    "src/app/api/**/*.ts": {
      "maxDuration": 30
    }
  },
  "env": {
    "PRISMA_GENERATE_SKIP_AUTOINSTALL": "true"
  }
}
```

### ローカル環境でのビルドテスト

```bash
# プロダクションビルド
npm run build

# プロダクションサーバー起動
npm start

# 型チェック
npx tsc --noEmit

# Lintチェック
npm run lint
```

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### 🔴 データベース接続エラー
```
Error: Can't reach database server
```
**解決方法**:
1. PostgreSQLサービスが起動しているか確認
2. `.env`ファイルの`DATABASE_URL`が正しいか確認
3. データベースが存在するか確認
4. ネットワーク接続を確認

#### 🔴 Prismaマイグレーションエラー
```
Error: Migration failed
```
**解決方法**:
```bash
# Prismaクライアント再生成
npx prisma generate

# マイグレーション状態確認
npx prisma migrate status

# 必要に応じてリセット（開発環境のみ）
npx prisma migrate reset
```

#### 🔴 ログインできない
**解決方法**:
1. 会社コードが正しいか確認（本番環境: 00001）
2. メールアドレス・パスワードが正しいか確認
3. 組織データが存在するか確認
4. ユーザーアカウントが正しく作成されているか確認

#### 🔴 工数入力時のエラー
**解決方法**:
1. プロジェクト、工程、タスクが正しく設定されているか確認
2. 入力値（時間）が数値形式か確認
3. 必須項目がすべて入力されているか確認
4. 日付形式が正しいか確認

#### 🔴 本番環境でのエラー
**解決方法**:
1. Vercel Dashboard でログを確認
2. 環境変数が正しく設定されているか確認
3. データベース接続文字列を確認
4. Prismaクライアントが正しく生成されているか確認

### デバッグツール

#### 開発環境
```bash
# Prisma Studio（データベースGUI）
npx prisma studio

# データベース接続テスト
node check-db.js

# 本番データ確認
node check-production-data.js

# データ整合性チェック
node check-data-integrity.js
```

#### ログの確認
```bash
# 開発サーバーログ
npm run dev

# Vercel本番ログ
vercel logs [deployment-url]
```

## 👨‍💻 開発ガイド

### 開発ワークフロー

#### 1. 機能開発
```bash
# 新機能ブランチ作成
git checkout -b feature/new-feature

# 開発・テスト
npm run dev

# コミット
git add .
git commit -m "✨ feat: 新機能の追加"

# プッシュ・プルリクエスト
git push origin feature/new-feature
```

#### 2. データベース変更
```bash
# スキーマ変更後
npx prisma migrate dev --name describe-changes

# 本番環境への適用
npx prisma migrate deploy
```

#### 3. 型安全性の確保
```bash
# TypeScript型チェック
npx tsc --noEmit

# Prisma型生成
npx prisma generate
```

### コーディング規約

#### TypeScript
- 厳密な型定義を使用
- `any`型の使用を避ける
- インターフェースを適切に定義

#### React
- 関数コンポーネントを使用
- Hooksを適切に活用
- propsの型定義を必須とする

#### CSS
- Tailwind CSSのユーティリティクラスを使用
- カスタムCSSは最小限に抑える
- レスポンシブデザインを考慮

### パフォーマンス最適化

#### フロントエンド
- React.memoでの不要な再レンダリング防止
- useCallbackとuseMemoの適切な使用
- 画像の最適化

#### バックエンド
- データベースクエリの最適化
- 適切なインデックスの設定
- N+1問題の回避

#### 本番環境
- Vercel Edge Networkの活用
- 静的ファイルの最適化
- データベース接続プールの設定

### セキュリティ対策

#### 認証・認可
- bcryptjsでのパスワードハッシュ化
- セッションベース認証
- 役割ベースアクセス制御

#### データ保護
- SQLインジェクション対策（Prisma ORM）
- XSS対策
- CSRF対策

#### 本番環境
- HTTPS通信の強制
- セキュリティヘッダーの設定
- 環境変数での機密情報管理

### テスト戦略

#### 単体テスト
```bash
# Jest + Testing Library（今後実装予定）
npm run test
```

#### E2Eテスト
```bash
# Playwright（今後実装予定）
npm run test:e2e
```

#### 手動テスト
- 各機能の動作確認
- 権限制御の確認
- レスポンシブデザインの確認

## 📊 プロジェクト統計

### 開発状況
- **開発期間**: 2025年6月25日〜現在
- **主要機能**: 15+ 機能実装済み
- **完成度**: 基本機能100%、高度機能80%

### コードベース
- **ファイル数**: 50+ ファイル
- **コンポーネント**: 10+ コンポーネント
- **API エンドポイント**: 20+ エンドポイント
- **データベーステーブル**: 10+ テーブル

### 技術的品質
- **型安全性**: 高（TypeScript + Prisma）
- **コード品質**: 良好（ESLint使用）
- **セキュリティ**: 基本対策済み
- **保守性**: 良好（明確な構造）

## 🔄 更新履歴

### v1.2.0 (2025/07/03) - レポート機能・カレンダー機能大幅強化
- 🚀 **人月計算機能**: 営業日数ベースの人月計算（1人月 = 7.5h × 営業日数）を実装
- 📊 **CSV出力改善**: プロジェクト→工程→作業→ユーザー順の昇順ソート機能
- 📈 **小計・合計機能**: 工程単位での小計、全体合計の自動計算を追加
- 📋 **レポート強化**: 月次・日次・人別集計すべてで小計・合計に対応
- 👥 **チーム表示機能**: プロジェクトマネージャーがメンバーの工数状況をカレンダーで確認可能
- 🎨 **ユーザー別色分け**: チーム表示時の視認性向上（8色のカラーパレット）
- 👤 **入力者表示**: 誰が工数を入力したかを表示する機能
- ⏰ **入力時刻表示**: 工数入力の時刻情報を表示
- 🔗 **プロジェクト連動**: 選択されたプロジェクトのメンバー工数を表示
- 📅 **営業日計算**: 祝日・土日を除いた正確な営業日数計算
- 🔧 **ESLint対応**: コード品質の向上とビルドエラー解決

### v1.0.0 (2025/06/30) - 本番環境リリース
- ✅ **本番環境稼働開始**: Vercel + Neon PostgreSQL
- ✅ **基本機能完成**: ユーザー管理、プロジェクト管理、工数管理
- ✅ **組織管理**: 4階層組織構造の実装
- ✅ **WBS管理**: ガントチャート、ダッシュボード、カレンダー
- ✅ **権限制御**: 役割ベースアクセス制御
- ✅ **一括操作**: 工数・WBS一括入力機能

### v0.9.0 (2025/06/29) - WBS管理システム実装
- 🆕 **WBS管理**: 独立した作業管理システム
- 🆕 **ガントチャート**: 作業スケジュール可視化
- 🆕 **進捗ダッシュボード**: 担当者別負荷分析
- 🆕 **カレンダー表示**: 作業予定・実績表示

### v0.8.0 (2025/06/28) - 組織管理システム実装
- 🆕 **組織階層**: 会社→事業部→部署→グループ
- 🆕 **組織マスタ**: 各階層の管理機能
- 🆕 **ユーザー所属**: 組織への所属管理

### v0.7.0 (2025/06/27) - 本番環境データ対応
- 🔧 **本番環境修正**: 組織データ不足問題の解決
- 🔧 **シードデータ**: 本番環境用初期データ作成
- 🔧 **ログイン修正**: 会社コード必須対応

### v0.5.0 (2025/06/26) - 高度機能実装
- ✨ **一括工数入力**: カレンダー形式での一括入力
- ✨ **ダッシュボード**: 進捗可視化・分析機能
- ✨ **権限制御**: コンポーネントレベルでの表示制御

### v0.1.0 (2025/06/25) - 初期リリース
- 🎉 **基盤機能**: Next.js + TypeScript + Prisma
- 🎉 **認証システム**: ログイン・権限管理
- 🎉 **基本機能**: プロジェクト・工数管理

## 📞 サポート・お問い合わせ

### 技術サポート
- **Issue報告**: GitHubのIssueページで問題を報告
- **機能要望**: 新機能の提案や改善要望
- **バグ報告**: 不具合
